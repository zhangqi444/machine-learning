
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>43.64. Case Study: Debugging in Regression &#8212; Machine Learning Open Book</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/drawio.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/youtube.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "open-academy/machine-learning-utterances");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="https://wavedrom.com/skins/default.js"></script>
    <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="https://cdn.jsdelivr.net/gh/bonartm/quizdown-js@latest/public/build/quizdown.js"></script>
    <script>quizdown.init({"quizdown_js": "https://cdn.jsdelivr.net/gh/bonartm/quizdown-js@latest/public/build/quizdown.js"});</script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="43.65. Study the solvers" href="../ml-fundamentals/study-the-solvers.html" />
    <link rel="prev" title="43.63. Case Study: Debugging in Classification" href="debugging-in-classification.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Machine Learning Open Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  PREREQUISITES
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../prerequisites/python-programming-introduction.html">
   1. Python programming introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../prerequisites/python-programming-basics.html">
   2. Python programming basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../prerequisites/python-programming-advanced.html">
   3. Python programming advanced
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  DATA SCIENCE
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data-science/introduction/introduction.html">
   4. Introduction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/introduction/defining-data-science.html">
     4.1. Defining data science
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/introduction/data-science-ethics.html">
     4.2. Data Science ethics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/introduction/defining-data.html">
     4.3. Defining data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/introduction/introduction-to-statistics-and-probability.html">
     4.4. Introduction to statistics and probability
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data-science/working-with-data/working-with-data.html">
   5. Working with data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/working-with-data/relational-databases.html">
     5.1. Relational databases
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/working-with-data/non-relational-data.html">
     5.2. Non-relational data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/working-with-data/numpy.html">
     5.3. NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/working-with-data/pandas.html">
     5.4. Pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/working-with-data/data-preparation.html">
     5.5. Data preparation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data-science/data-visualization/data-visualization.html">
   6. Data visualization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-visualization/visualizing-quantities.html">
     6.1. Visualizing quantities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-visualization/visualization-distributions.html">
     6.2. Visualizing distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-visualization/visualization-proportions.html">
     6.3. Visualizing proportions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-visualization/visualization-relationships.html">
     6.4. Visualizing relationships: all about honey 🍯
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-visualization/meaningful-visualizations.html">
     6.5. Making meaningful visualizations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data-science/data-science-lifecycle/data-science-lifecycle.html">
   7. Data Science lifecycle
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-science-lifecycle/introduction.html">
     7.1. Introduction to the Data Science lifecycle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-science-lifecycle/analyzing.html">
     7.2. Analyzing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-science-lifecycle/communication.html">
     7.3. Communication
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data-science/data-science-in-the-cloud/data-science-in-the-cloud.html">
   8. Data Science in the cloud
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-science-in-the-cloud/introduction.html">
     8.1. Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-science-in-the-cloud/the-low-code-no-code-way.html">
     8.2. The “low code/no code” way
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-science-in-the-cloud/the-azure-ml-sdk-way.html">
     8.3. Data Science in the cloud: The “Azure ML SDK” way
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data-science/data-science-in-the-wild.html">
   9. Data Science in the real world
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  FUNDAMENTALS OF MACHINE LEARNING
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ml-fundamentals/ml-overview.html">
   10. Machine learning overview
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ml-fundamentals/regression/regression-models-for-machine-learning.html">
   11. Regression models for Machine Learning
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ml-fundamentals/regression/tools-of-the-trade.html">
     11.1. Tools of the trade
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ml-fundamentals/regression/managing-data.html">
     11.2. Managing data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ml-fundamentals/regression/linear-and-polynomial-regression.html">
     11.3. Linear and polynomial regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ml-fundamentals/regression/logistic-regression.html">
     11.4. Logistic regression
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ml-fundamentals/build-a-web-app-to-use-a-machine-learning-model.html">
   12. Build a web app to use a Machine Learning model
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ml-fundamentals/classification/getting-started-with-classification.html">
   13. Getting started with classification
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ml-fundamentals/classification/introduction-to-classification.html">
     13.1. Introduction to classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ml-fundamentals/classification/more-classifiers.html">
     13.2. More classifiers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ml-fundamentals/classification/yet-other-classifiers.html">
     13.3. Yet other classifiers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ml-fundamentals/classification/applied-ml-build-a-web-app.html">
     13.4. Applied Machine Learning : build a web app
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  ADVANCED MACHINE LEARNING
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ml-advanced/clustering/clustering-models-for-machine-learning.html">
   14. Clustering models for Machine Learning
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ml-advanced/clustering/introduction-to-clustering.html">
     14.1. Introduction to clustering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ml-advanced/clustering/k-means-clustering.html">
     14.2. K-Means clustering
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ml-advanced/kernel-method.html">
   15. Kernel method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ml-advanced/model-selection.html">
   16. Model selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ml-advanced/ensemble-learning.html">
   17. Ensemble learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ml-advanced/unsupervised-learning.html">
   18. Unsupervised learning (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ml-advanced/generative-models.html">
   19. Generative models
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  DEEP LEARNING
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/dl-overview.html">
   20. Deep learning overview (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/CNN.html">
   21. Convolutional Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/GAN.html">
   22. Generative adversarial networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/RNN.html">
   23. Recurrent Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/AutoEncoder.html">
   24. Autoencoder
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/LSTM.html">
   25. Long-short term memory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/NLP.html">
   26. NLP (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/time-series.html">
   27. Time series (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/DQN.html">
   28. DQN (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/dl-summary.html">
   29. Summary of deep learning (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/image-classification.html">
   30. Image classification
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MACHINE LEARNING PRODUCTIONIZATION
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../machine-learning-productionization/overview.html">
   31. Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../machine-learning-productionization/problem-framing.html">
   32. Problem framing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../machine-learning-productionization/data-engineering.html">
   33. Data engineering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../machine-learning-productionization/model-training-and-evaluation.html">
   34. Model training &amp; evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../machine-learning-productionization/model-deployment.html">
   35. Model deployment
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  SUPPORTING MATERIALS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/pytorch.html">
   36. PyTorch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/bamboolib.html">
   37. Bamboolib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/mito.html">
   38. Mito
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/KNN.html">
   39. KNN (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/semi-supervised-learning.html">
   40. Semi-supervised learning (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/unbalanced-problems.html">
   41. Unbalanced problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/automl.html">
   42. AutoML (TBD)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  OTHERS
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../introduction.html">
   43. Assignments
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../get-started.html">
     43.1. Get started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../set-up-env/first-assignment.html">
     43.2. First assignment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../set-up-env/second-assignment.html">
     43.3. Second assignment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../project-plan-template.html">
     43.4. Project Plan​ Template
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../prerequisites/python-programming-introduction.html">
     43.5. Python programming introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../prerequisites/python-programming-basics.html">
     43.6. Python programming basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../prerequisites/python-programming-advanced.html">
     43.7. Python programming advanced
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/analyzing-text-about-data-science.html">
     43.8. Analyzing text about Data Science
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/data-science-scenarios.html">
     43.9. Data Science scenarios
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/write-a-data-ethics-case-study.html">
     43.10. Write a data ethics case study
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/lines-scatters-and-bars.html">
     43.11. Lines, scatters and bars
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/apply-your-skills.html">
     43.12. Apply your skills
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/try-it-in-excel.html">
     43.13. Try it in Excel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/let-us-learn-about-birds.html">
     43.14. Let’s learn about birds
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/bird-distributions.html">
     43.15. Bird distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/dive-into-the-beehive.html">
     43.16. Dive into the beehive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/build-your-own-custom-vis.html">
     43.17. Build your own custom vis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/classifying-datasets.html">
     43.18. Classifying datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/small-diabetes-study.html">
     43.19. Small diabetes study
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/introduction-to-statistics-and-probability.html">
     43.20. Introduction to probability and statistics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/displaying-airport-data.html">
     43.21. Displaying airport data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/soda-profits.html">
     43.22. Soda profits
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/analyzing-COVID-19-papers.html">
     43.23. Analyzing COVID-19 papers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/estimation-of-COVID-19-pandemic.html">
     43.24. Estimation of COVID-19 pandemic
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/data-processing-in-python.html">
     43.25. Data processing in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/evaluating-data-from-a-form.html">
     43.26. Evaluating data from a form
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/data-preparation.html">
     43.27. Data preparation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/analyzing-data.html">
     43.28. Analyzing data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/nyc-taxi-data-in-winter-and-summer.html">
     43.29. NYC taxi data in winter and summer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/matplotlib-applied.html">
     43.30. Matplotlib applied
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/tell-a-story.html">
     43.36. Tell a story
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/explore-a-planetary-computer-dataset.html">
     43.37. Explore a planetary computer dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/exploring-for-anwser.html">
     43.38. Exploring for answers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/market-research.html">
     43.39. Market research
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/low-code-no-code-data-science-project-on-azure-ml.html">
     43.40. Low code/no code Data Science project on Azure ML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/data-science-project-using-azure-ml-sdk.html">
     43.41. Data Science project using Azure ML SDK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/data-science-in-the-cloud-the-azure-ml-sdk-way.html">
     43.42. Data Science in the cloud: The “Azure ML SDK” way
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/ml-overview-iris.html">
     43.43. Machine Learning overview - assignment 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/ml-overview-mnist-digits.html">
     43.44. Digit Recognizer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/regression-with-scikit-learn.html">
     43.46. Regression with Scikit-learn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/regression-tools.html">
     43.47. Regression tools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/managing-data.html">
     43.48. Managing data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/exploring-visualizations.html">
     43.49. Exploring visualizations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/try-a-different-model.html">
     43.50. Try a different model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/create-a-regression-model.html">
     43.51. Create a regression model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/linear-and-polynomial-regression.html">
     43.52. Linear and polynomial regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/build-classification-models-predict-the-price-range.html">
     43.53. Build classification models：Predict the price range
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/retrying-some-regression.html">
     43.54. Retrying some regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/pumpkin-varieties-and-color.html">
     43.55. Pumpkin varieties and color
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/delicious-asian-and-indian-cuisines.html">
     43.56. Delicious asian and indian cuisines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/explore-classification-methods.html">
     43.57. Explore classification methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-advanced/ensemble-learning/random-forests-intro-and-regression.html">
     43.58. Random forests intro and regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-advanced/ensemble-learning/random-forests-for-classification.html">
     43.59. Random forests for classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-advanced/ensemble-learning/beyond-random-forests-more-ensemble-models.html">
     43.60. Beyond random forests: more ensemble models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="data-engineering.html">
     43.61. Data engineering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="counterintuitive-challenges-in-ml-debugging.html">
     43.62. Counterintuitive Challenges in ML Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="debugging-in-classification.html">
     43.63. Case Study: Debugging in Classification
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     43.64. Case Study: Debugging in Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/study-the-solvers.html">
     43.65. Study the solvers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/build-classification-models.html">
     43.66. Build classification models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/build-classification-model.html">
     43.67. Build Classification Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ml-fundamentals/parameter-play.html">
     43.68. Parameter play
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../slides/introduction.html">
   44. Slides
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/python-programming/python-programming-introduction.html">
     44.1. Python programming introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/python-programming/python-programming-basics.html">
     44.2. Python programming basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/python-programming/python-programming-advanced.html">
     44.3. Python programming advanced
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/data-science/data-science-introduction.html">
     44.4. Data Science introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/data-science/relational-vs-non-relational-database.html">
     44.5. Relational vs. non-relational database
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/data-science/numpy-and-pandas.html">
     44.6. NumPy and Pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/data-science/data-visualization.html">
     44.7. Data visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/data-science/data-science-lifecycle.html">
     44.8. Data Science lifecycle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/data-science/data-science-in-the-cloud.html">
     44.9. Data Science in the cloud
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/data-science/data-science-in-real-world.html">
     44.10. Data Science in real world
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/ml-fundamentals/ml-overview.html">
     44.11. Machine Learning overview
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/open-academy/machine-learning/main?urlpath=tree/open-machine-learning-jupyter-book/assignments/machine-learning-productionization/debugging-in-regression.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/open-academy/machine-learning/blob/main/open-machine-learning-jupyter-book/assignments/machine-learning-productionization/debugging-in-regression.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/open-academy/machine-learning/"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/open-academy/machine-learning//issues/new?title=Issue%20on%20page%20%2Fassignments/machine-learning-productionization/debugging-in-regression.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/open-academy/machine-learning/edit/main/open-machine-learning-jupyter-book/assignments/machine-learning-productionization/debugging-in-regression.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/assignments/machine-learning-productionization/debugging-in-regression.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   43.64.1. Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-correlation-matrix">
   43.64.2. Check Correlation Matrix
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validate-input-data-against-data-schema">
   43.64.3. Validate Input Data against Data Schema
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution">
     43.64.3.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#split-and-normalize-data">
   43.64.4. Split and Normalize Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-engineered-data">
   43.64.5. Test Engineered Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-splits-for-statistical-equivalence">
   43.64.6. Check Splits for Statistical Equivalence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#establish-a-baseline">
   43.64.7. Establish a Baseline
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-model">
   43.64.8. Linear Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hint">
     43.64.8.1. Hint
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     43.64.8.2. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-feature-to-linear-model">
   43.64.9. Add Feature to Linear Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     43.64.9.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#use-a-nonlinear-model">
   43.64.10. Use a Nonlinear Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     43.64.10.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimize-your-model">
   43.64.11. Optimize Your Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     43.64.11.1. Hint
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     43.64.11.2. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-for-implementation-bugs-using-reduced-dataset">
   43.64.12. Check for Implementation Bugs using Reduced Dataset
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     43.64.12.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trying-a-very-complex-model">
   43.64.13. Trying a Very Complex Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results">
     43.64.13.1. Results
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   43.64.14. Conclusion
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Case Study: Debugging in Regression</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   43.64.1. Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-correlation-matrix">
   43.64.2. Check Correlation Matrix
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validate-input-data-against-data-schema">
   43.64.3. Validate Input Data against Data Schema
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution">
     43.64.3.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#split-and-normalize-data">
   43.64.4. Split and Normalize Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-engineered-data">
   43.64.5. Test Engineered Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-splits-for-statistical-equivalence">
   43.64.6. Check Splits for Statistical Equivalence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#establish-a-baseline">
   43.64.7. Establish a Baseline
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-model">
   43.64.8. Linear Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hint">
     43.64.8.1. Hint
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     43.64.8.2. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-feature-to-linear-model">
   43.64.9. Add Feature to Linear Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     43.64.9.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#use-a-nonlinear-model">
   43.64.10. Use a Nonlinear Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     43.64.10.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimize-your-model">
   43.64.11. Optimize Your Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     43.64.11.1. Hint
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     43.64.11.2. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-for-implementation-bugs-using-reduced-dataset">
   43.64.12. Check for Implementation Bugs using Reduced Dataset
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     43.64.12.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trying-a-very-complex-model">
   43.64.13. Trying a Very Complex Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results">
     43.64.13.1. Results
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   43.64.14. Conclusion
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <details><summary><b>LICENSE</b></summary>
<p>Copyright 2018 Google LLC.</p>
<p>Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<p><a class="reference external" href="https://www.apache.org/licenses/LICENSE-2.0">https://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
</details><section class="tex2jax_ignore mathjax_ignore" id="case-study-debugging-in-regression">
<h1><span class="section-number">43.64. </span>Case Study: Debugging in Regression<a class="headerlink" href="#case-study-debugging-in-regression" title="Permalink to this headline">#</a></h1>
<p>In this Colab, you will learn how to debug a regression problem through a case study. You will:</p>
<ol class="simple">
<li><p>Set up the problem.</p></li>
<li><p>Interpret the correlation matrix.</p></li>
<li><p>Implement linear and nonlinear models.</p></li>
<li><p>Compare and choose between linear and nonlinear models.</p></li>
<li><p>Optimize your chosen model.</p></li>
<li><p>Debug your chosen model.</p></li>
</ol>
<section id="setup">
<h2><span class="section-number">43.64.1. </span>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h2>
<p>This Colab uses the wine quality dataset&lt;sup#[1]&lt;/sup#, which is hosted at <a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/wine+quality">UCI</a>. This dataset contains data on the physicochemical properties of wine along with wine quality ratings. The problem is to predict wine quality (0-10) from physicochemical properties.</p>
<p>Please <strong>make a copy</strong> of this Colab before running it. Click on <em>File</em>, and then click on <em>Save a copy in Drive</em>.</p>
<p>&lt;small#[1] Modeling wine preferences by data mining from physicochemical properties. P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. Decision Support Systems, Elsevier, 47(4):547-553, 2009.&lt;/small#</p>
<p>Load libraries and data by running the next cell. Display the first few rows to verify that the dataset loaded correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reset environment for a new run</span>
<span class="o">%</span><span class="k">reset</span> -f

<span class="c1"># Load libraries</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span> <span class="c1"># for joining file pathnames</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Set Pandas display options</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>

<span class="n">wineDf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
  <span class="s2">&quot;https://download.mlcc.google.com/mledu-datasets/winequality.csv&quot;</span><span class="p">,</span>
  <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span>
<span class="n">wineDf</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fixed acidity&#39;</span><span class="p">,</span><span class="s1">&#39;volatile acidity&#39;</span><span class="p">,</span><span class="s1">&#39;citric acid&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;residual sugar&#39;</span><span class="p">,</span><span class="s1">&#39;chlorides&#39;</span><span class="p">,</span><span class="s1">&#39;free sulfur dioxide&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;total sulfur dioxide&#39;</span><span class="p">,</span><span class="s1">&#39;density&#39;</span><span class="p">,</span><span class="s1">&#39;pH&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;sulphates&#39;</span><span class="p">,</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span>
<span class="n">wineDf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-correlation-matrix">
<h2><span class="section-number">43.64.2. </span>Check Correlation Matrix<a class="headerlink" href="#check-correlation-matrix" title="Permalink to this headline">#</a></h2>
<p>Before developing your ML model, you need to select features. To find informative features, check the correlation matrix by running the following cell. Which features are informative?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_wineDf</span> <span class="o">=</span> <span class="n">wineDf</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_wineDf</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">alcohol</span></code> is most highly correlated with <code class="docutils literal notranslate"><span class="pre">quality</span></code>. Looking for other informative features, notice that <code class="docutils literal notranslate"><span class="pre">volatile</span> <span class="pre">acidity</span></code> correlates with <code class="docutils literal notranslate"><span class="pre">quality</span></code> but not with <code class="docutils literal notranslate"><span class="pre">alcohol</span></code>, making it a good second feature. Remember that a correlation matrix is not helpful if predictive signals are encoded in combinations of features.</p>
</section>
<section id="validate-input-data-against-data-schema">
<h2><span class="section-number">43.64.3. </span>Validate Input Data against Data Schema<a class="headerlink" href="#validate-input-data-against-data-schema" title="Permalink to this headline">#</a></h2>
<p>Before processing your data, you should validate the data against a data schema as described in <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/data-errors">Data and Feature Debugging</a>.</p>
<p>First, define a function that validates data against a schema.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Define function to validate data</span>

<span class="k">def</span> <span class="nf">test_data_schema</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Tests that the datatypes and ranges of values in the dataset</span>
<span class="sd">    adhere to expectations.</span>

<span class="sd">    Args:</span>
<span class="sd">      input_function: Dataframe containing data to test</span>
<span class="sd">      schema: Schema which describes the properties of the data.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">test_dtypes</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">assert</span> <span class="n">input_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span>
          <span class="n">schema</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="s1">&#39;dtype&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">(</span>
          <span class="s2">&quot;Incorrect dtype in column &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="n">column</span>
      <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input dtypes are correct.&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">test_ranges</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">schema_max</span> <span class="o">=</span> <span class="n">schema</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="s1">&#39;range&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]</span>
      <span class="n">schema_min</span> <span class="o">=</span> <span class="n">schema</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="s1">&#39;range&#39;</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]</span>
      <span class="c1"># Assert that data falls between schema min and max.</span>
      <span class="k">assert</span> <span class="n">input_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">schema_max</span><span class="p">,</span> <span class="p">(</span>
          <span class="s2">&quot;Maximum value of column &#39;</span><span class="si">%s</span><span class="s2">&#39; is too low.&quot;</span> <span class="o">%</span> <span class="n">column</span>
      <span class="p">)</span>
      <span class="k">assert</span> <span class="n">input_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="c1">#= schema_min, (</span>
          <span class="s2">&quot;Minimum value of column &#39;</span><span class="si">%s</span><span class="s2">&#39; is too high.&quot;</span> <span class="o">%</span> <span class="n">column</span>
      <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data falls within specified ranges.&#39;</span><span class="p">)</span>

  <span class="n">test_dtypes</span><span class="p">()</span>
  <span class="n">test_ranges</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To define your schema, you need to understand the statistical properties of your dataset. Generate statistics on your dataset by running the following code cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wineDf</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Using the statistics generated above, define the data schema in the following code cell. For demonstration purposes, restrict your data schema to the first three data columns. For each data column, enter the:</p>
<ul class="simple">
<li><p>minimum value</p></li>
<li><p>maximum value</p></li>
<li><p>data type</p></li>
</ul>
<p>As an example, the values for the first column are filled out. After entering the values, run the code cell to confirm that your input data matches the schema.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine_schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fixed acidity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">3.8</span><span class="p">,</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">15.9</span>
        <span class="p">},</span>
        <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;volatile acidity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="p">,</span> <span class="c1"># describe() rounds up this value, be careful</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span>
        <span class="p">},</span>
        <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;citric acid&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="p">,</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span>
        <span class="p">},</span>
        <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Validating wine data against data schema...&#39;</span><span class="p">)</span>
<span class="n">test_data_schema</span><span class="p">(</span><span class="n">wineDf</span><span class="p">,</span> <span class="n">wine_schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="solution">
<h3><span class="section-number">43.64.3.1. </span>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine_schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fixed acidity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">3.7</span><span class="p">,</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">15.9</span>
        <span class="p">},</span>
        <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;volatile acidity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.08</span><span class="p">,</span>  <span class="c1"># minimum value</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.6</span>   <span class="c1"># maximum value</span>
        <span class="p">},</span>
        <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>    <span class="c1"># data type</span>
    <span class="p">},</span>
    <span class="s1">&#39;citric acid&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="c1"># minimum value</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.7</span>  <span class="c1"># maximum value</span>
        <span class="p">},</span>
        <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>   <span class="c1"># data type</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Validating wine data against data schema...&#39;</span><span class="p">)</span>
<span class="n">test_data_schema</span><span class="p">(</span><span class="n">wineDf</span><span class="p">,</span> <span class="n">wine_schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="split-and-normalize-data">
<h2><span class="section-number">43.64.4. </span>Split and Normalize Data<a class="headerlink" href="#split-and-normalize-data" title="Permalink to this headline">#</a></h2>
<p>Split the dataset into data and labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wineFeatures</span> <span class="o">=</span> <span class="n">wineDf</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">wineFeatures</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;quality&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">wineLabels</span> <span class="o">=</span> <span class="n">wineDf</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Normalize data using z-score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normalizeData</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
  <span class="n">stdArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
  <span class="n">meanArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
  <span class="n">arr</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="o">-</span><span class="n">meanArr</span><span class="p">)</span><span class="o">/</span><span class="n">stdArr</span>
  <span class="k">return</span> <span class="n">arr</span>

<span class="k">for</span> <span class="n">str1</span> <span class="ow">in</span> <span class="n">wineFeatures</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
   <span class="n">wineFeatures</span><span class="p">[</span><span class="n">str1</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizeData</span><span class="p">(</span><span class="n">wineFeatures</span><span class="p">[</span><span class="n">str1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-engineered-data">
<h2><span class="section-number">43.64.5. </span>Test Engineered Data<a class="headerlink" href="#test-engineered-data" title="Permalink to this headline">#</a></h2>
<p>After normalizing your data, you should test your engineered data for errors as described in <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/data-errors">Data and Feature Debugging</a>. In this section, you will test that engineering data:</p>
<ul class="simple">
<li><p>Has the expected number of rows and columns.</p></li>
<li><p>Does not have null values.</p></li>
</ul>
<p>First, set up the testing functions by running the following code cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">def</span> <span class="nf">test_input_dim</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_columns</span><span class="p">):</span>
  <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_rows</span><span class="p">,</span> <span class="s2">&quot;Unexpected number of rows.&quot;</span>
  <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_columns</span><span class="p">,</span> <span class="s2">&quot;Unexpected number of columns.&quot;</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Engineered data has the expected number of rows and columns.&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_nulls</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
  <span class="n">dataNulls</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
  <span class="k">assert</span> <span class="n">dataNulls</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Nulls in engineered data.&quot;</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Engineered features do not contain nulls.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Your input data had 6497 examples and 11 feature columns. Test whether your engineered data has the expected number of rows and columns by running the following cell. Confirm that the test fails if you change the values below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Test dimensions of engineered data</span>
<span class="n">wine_feature_rows</span> <span class="o">=</span> <span class="mi">6497</span> <span class="c1">#@param</span>
<span class="n">wine_feature_cols</span> <span class="o">=</span> <span class="mi">11</span> <span class="c1">#@param</span>
<span class="n">test_input_dim</span><span class="p">(</span><span class="n">wineFeatures</span><span class="p">,</span>
               <span class="n">wine_feature_rows</span><span class="p">,</span>
               <span class="n">wine_feature_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Test that your engineered data does not contain nulls by running the code below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_nulls</span><span class="p">(</span><span class="n">wineFeatures</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-splits-for-statistical-equivalence">
<h2><span class="section-number">43.64.6. </span>Check Splits for Statistical Equivalence<a class="headerlink" href="#check-splits-for-statistical-equivalence" title="Permalink to this headline">#</a></h2>
<p>As described in the <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/data-errors">Data Debugging</a> guidelines, before developing your model, you should check that your training and validation splits are equally representative. Assuming a training:validation split of 80:20, compare the mean and the standard deviation of the splits by running the next two code cells. Note that this comparison is not a rigorous test for statistical equivalence but simply a quick and dirty comparison of the splits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">splitIdx</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span><span class="o">/</span><span class="mi">10</span>
<span class="n">wineFeatures</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">splitIdx</span><span class="p">,:]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wineFeatures</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">splitIdx</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The two splits are clearly not equally representative. To make the splits equally representative, you can shuffle the data.</p>
<p>Run the following code cell to shuffle the data, and then recreate the features and labels from the shuffled data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shuffle data</span>
<span class="n">wineDf</span> <span class="o">=</span> <span class="n">wineDf</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Recreate features and labels</span>
<span class="n">wineFeatures</span> <span class="o">=</span> <span class="n">wineDf</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">wineFeatures</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;quality&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">wineLabels</span> <span class="o">=</span> <span class="n">wineDf</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, confirm that the splits are equally representative by regenerating and comparing the statistics using the previous code cells. You may wonder why the initial splits differed so greatly. It turns out that in the wine dataset, the first 4897 rows contain data on white wines and the next 1599 rows contain data on red wines. When you split your dataset 80:20, then your training dataset contains 5197 examples, which is 94% white wine. The validation dataset is purely red wine.</p>
<p>Ensuring your splits are statistically equivalent is a good development practice. In general, following good development practices will simplify your model debugging. To learn about testing for statistical equivalence, see <a class="reference external" href="https://journals.sagepub.com/doi/10.1177/1948550617697177">Equivalence Tests Lakens, D.</a>.</p>
</section>
<section id="establish-a-baseline">
<h2><span class="section-number">43.64.7. </span>Establish a Baseline<a class="headerlink" href="#establish-a-baseline" title="Permalink to this headline">#</a></h2>
<p>For a regression problem, the simplest baseline to predict the average value. Run the following code to calculate the mean-squared error (MSE) loss on the training split using the average value as a baseline. Your loss is approximately 0.75. Any model should beat this loss to justify its use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baselineMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">wineLabels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">splitIdx</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wineLabels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">splitIdx</span><span class="p">]))</span>
<span class="n">baselineMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">baselineMSE</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">baselineMSE</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">baselineMSE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="linear-model">
<h2><span class="section-number">43.64.8. </span>Linear Model<a class="headerlink" href="#linear-model" title="Permalink to this headline">#</a></h2>
<p>Following good ML dev practice, let’s start with a linear model that uses the most informative feature from the correlation matrix: <code class="docutils literal notranslate"><span class="pre">alcohol</span></code>. Even if this model performs badly, we can still use it as a baseline. This model should beat our previous baseline’s MSE of 0.75.</p>
<p>First, let’s define a function to plot our loss and accuracy curves. The function will also print the final loss and accuracy. Instead of using <code class="docutils literal notranslate"><span class="pre">verbose=1</span></code>, you can call the function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Function to:</span>
<span class="sd">   * Print final loss.</span>
<span class="sd">   * Plot loss curves.</span>
<span class="sd">  </span>
<span class="sd">  Args:</span>
<span class="sd">    trainHistory: object returned by model.fit</span>
<span class="sd">  &quot;&quot;&quot;</span>
  
  <span class="c1"># Print final loss</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final training loss: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final Validation loss: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
  
  <span class="c1"># Plot loss curves</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">])</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Training loss&#39;</span><span class="p">,</span><span class="s1">&#39;Validation loss&#39;</span><span class="p">],</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Loss Curves&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For fast prototyping, let’s try using a full batch per epoch to update the gradient only once per  epoch. Use the full batch by setting <code class="docutils literal notranslate"><span class="pre">batch_size</span> <span class="pre">=</span> <span class="pre">wineFeatures.shape[0]</span></code> as indicated by the code comment.</p>
<p>What do you think of the loss curve? Can you improve it? For hints and discussion, see the following text cells.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Choose feature</span>
<span class="n">wineFeaturesSimple</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">]</span>
<span class="c1"># Define model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="c1"># Specify the optimizer using the TF API to specify the learning rate</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
              <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train the model!</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
                         <span class="n">wineLabels</span><span class="p">,</span>
                         <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                         <span class="n">batch_size</span><span class="o">=</span><span class="p">,</span> <span class="c1"># set batch size here</span>
                         <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="hint">
<h3><span class="section-number">43.64.8.1. </span>Hint<a class="headerlink" href="#hint" title="Permalink to this headline">#</a></h3>
<p>The loss decreases but very slowly. Possible fixes are:</p>
<ul class="simple">
<li><p>Increase number of epochs.</p></li>
<li><p>Increase learning rate.</p></li>
<li><p>Decrease batch size. A lower batch size can result in larger decrease in loss per epoch, under the assumption that the smaller batches stay representative of the overall data distribution.</p></li>
</ul>
<p>Play with these three parameters in the code above to decrease the loss.</p>
</section>
<section id="id1">
<h3><span class="section-number">43.64.8.2. </span>Solution<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>Run the following code cell to train the model using a reduced batch size of 100. Reducing the batch size leads to a greater decrease in loss per epoch. The minimum achievable loss is about 0.64. This is a significant increase over our baseline of 0.75.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Choose feature</span>
<span class="n">wineFeaturesSimple</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">]</span>
<span class="c1"># Define model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="c1"># Specify the optimizer using the TF API to specify the learning rate</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
              <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train the model!</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
                         <span class="n">wineLabels</span><span class="p">,</span>
                         <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                         <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="c1"># set batch size here</span>
                         <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="add-feature-to-linear-model">
<h2><span class="section-number">43.64.9. </span>Add Feature to Linear Model<a class="headerlink" href="#add-feature-to-linear-model" title="Permalink to this headline">#</a></h2>
<p>Try adding a feature to the linear model. Since you need to combine the two features into one prediction for regression, you’ll also need to add a second layer. Modify the code below to implement the following changes:</p>
<ol class="simple">
<li><p>Add <code class="docutils literal notranslate"><span class="pre">'volatile</span> <span class="pre">acidity'</span></code> to the features in <code class="docutils literal notranslate"><span class="pre">wineFeaturesSimple</span></code>.</p></li>
<li><p>Add a second linear layer with 1 unit.</p></li>
<li><p>Experiment with learning rate, epochs, and batch_size to try to reduce loss.</p></li>
</ol>
<p>What happens to your loss?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Select features</span>
<span class="n">wineFeaturesSimple</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">]]</span> <span class="c1"># add &#39;volatile acidity&#39;</span>
<span class="c1"># Define model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="c1"># add second layer</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="p">),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
                         <span class="n">wineLabels</span><span class="p">,</span>
                         <span class="n">epochs</span><span class="o">=</span><span class="p">,</span>
                         <span class="n">batch_size</span><span class="o">=</span><span class="p">,</span>
                         <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h3><span class="section-number">43.64.9.1. </span>Solution<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h3>
<p>Run the following code to add the second feature and the second layer. The training loss is about 0.59, a small decrease from the previous loss of 0.64.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Select features</span>
<span class="n">wineFeaturesSimple</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span> <span class="s1">&#39;volatile acidity&#39;</span><span class="p">]]</span> <span class="c1"># add second feature</span>
<span class="c1"># Define model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span> <span class="c1"># add second layer</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
                         <span class="n">wineLabels</span><span class="p">,</span>
                         <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                         <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                         <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="use-a-nonlinear-model">
<h2><span class="section-number">43.64.10. </span>Use a Nonlinear Model<a class="headerlink" href="#use-a-nonlinear-model" title="Permalink to this headline">#</a></h2>
<p>Let’s try a nonlinear model. Modify the code below to make the following changes:</p>
<ol class="simple">
<li><p>Change the first layer to use <code class="docutils literal notranslate"><span class="pre">relu</span></code>. (Output layer stays linear since this is a regression problem.)</p></li>
<li><p>As usual, specify the learning rate, epochs, and batch_size.</p></li>
</ol>
<p>Run the cell. Does the loss increase, decrease, or stay the same?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Define</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Fit</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
          <span class="n">wineLabels</span><span class="p">,</span>
          <span class="n">epochs</span><span class="o">=</span><span class="p">,</span>
          <span class="n">batch_size</span><span class="o">=</span><span class="p">,</span>
          <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
          <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h3><span class="section-number">43.64.10.1. </span>Solution<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h3>
<p>Run the following cell to use a <code class="docutils literal notranslate"><span class="pre">relu</span></code> activation in your first hidden layer. Your loss stays about the same, perhaps declining negligibly to 0.58.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Define</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Fit</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
          <span class="n">wineLabels</span><span class="p">,</span>
          <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
          <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
          <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
          <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="optimize-your-model">
<h2><span class="section-number">43.64.11. </span>Optimize Your Model<a class="headerlink" href="#optimize-your-model" title="Permalink to this headline">#</a></h2>
<p>We have two features with one hidden layer but didn’t see an improvement. At this point, it’s tempting to use all your features with a high-capacity network. However, you must resist the temptation. Instead, follow the guidance in <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/optimization">Model Optimization</a> to improve model performance. For a hint and for a discussion, see the following text sections.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choose features</span>
<span class="n">wineFeaturesSimple</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span> <span class="s1">&#39;volatile acidity&#39;</span><span class="p">]]</span> <span class="c1"># add features</span>
<span class="c1"># Define</span>
<span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c1"># Add more layers here</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
                         <span class="n">wineLabels</span><span class="p">,</span>
                         <span class="n">epochs</span><span class="o">=</span><span class="p">,</span>
                         <span class="n">batch_size</span><span class="o">=</span><span class="p">,</span>
                         <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id4">
<h3><span class="section-number">43.64.11.1. </span>Hint<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h3>
<p>You can try to reduce loss by adding features, adding layers, or playing with the hyperparameters. Before adding more features, check the correlation matrix. Don’t expect your loss to decrease by much. Sadly, that is a common experience in machine learning!</p>
</section>
<section id="id5">
<h3><span class="section-number">43.64.11.2. </span>Solution<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h3>
<p>Run the following code to:</p>
<ul class="simple">
<li><p>Add the features chlorides and density.</p></li>
<li><p>Set training epochs to 100.</p></li>
<li><p>Set batch size to 100.</p></li>
</ul>
<p>Your loss reduces to about 0.56. That’s a minor improvement over the previous loss of 0.58. It seems that adding more features or capacity isn’t improving your model by much. Perhaps your model has a bug? In the next section, you will run a sanity check on your model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choose features</span>
<span class="n">wineFeaturesSimple</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span><span class="s1">&#39;volatile acidity&#39;</span><span class="p">,</span><span class="s1">&#39;chlorides&#39;</span><span class="p">,</span><span class="s1">&#39;density&#39;</span><span class="p">]]</span>
<span class="c1"># Define</span>
<span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c1"># Add more layers here</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
                         <span class="n">wineLabels</span><span class="p">,</span>
                         <span class="n">epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                         <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                         <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="check-for-implementation-bugs-using-reduced-dataset">
<h2><span class="section-number">43.64.12. </span>Check for Implementation Bugs using Reduced Dataset<a class="headerlink" href="#check-for-implementation-bugs-using-reduced-dataset" title="Permalink to this headline">#</a></h2>
<p>Your loss isn’t decreasing by much. Perhaps your model has an implementation bug. From the <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/model-errors">Model Debugging</a> guidelines, a quick test for implementation bugs is to obtain a low loss on a reduced dataset of, say, 10 examples. Remember, passing this test does not validate your modeling approach but only checks for basic implementation bugs. In your ML problem, if your model passes this test, then continue debugging your model to train on your full dataset.</p>
<p>In the following code, experiment with the learning rate, batch size, and number of epochs. Can you reach a low loss? Choose hyperparameter values that let you iterate quickly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choose 10 examples</span>
<span class="n">wineFeaturesSmall</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">wineLabelsSmall</span> <span class="o">=</span> <span class="n">wineLabels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="c1"># Define model</span>
<span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSmall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSmall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSmall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span> <span class="c1"># set LR</span>
<span class="c1"># Train</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSmall</span><span class="p">,</span>
                        <span class="n">wineLabelsSmall</span><span class="p">,</span>
                        <span class="n">epochs</span><span class="o">=</span><span class="p">,</span>
                        <span class="n">batch_size</span><span class="o">=</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final training loss: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<section id="id6">
<h3><span class="section-number">43.64.12.1. </span>Solution<a class="headerlink" href="#id6" title="Permalink to this headline">#</a></h3>
<p>Run the following code cell to train the model using these hyperparameter values:</p>
<ul class="simple">
<li><p>learning rate = 0.01</p></li>
<li><p>epochs = 200</p></li>
<li><p>batch size = 10</p></li>
</ul>
<p>You get a low loss on your reduced dataset. This result means your model is probably solid and your previous results are as good as they’ll get.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choose 10 examples</span>
<span class="n">wineFeaturesSmall</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">wineLabelsSmall</span> <span class="o">=</span> <span class="n">wineLabels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="c1"># Define model</span>
<span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSmall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSmall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSmall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span> <span class="c1"># set LR</span>
<span class="c1"># Train</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSmall</span><span class="p">,</span>
                        <span class="n">wineLabelsSmall</span><span class="p">,</span>
                        <span class="n">epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                        <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final training loss: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="trying-a-very-complex-model">
<h2><span class="section-number">43.64.13. </span>Trying a Very Complex Model<a class="headerlink" href="#trying-a-very-complex-model" title="Permalink to this headline">#</a></h2>
<p>Let’s go all in and use a very complex model with all the features. For science! And to satisfy ourselves that a simple model is indeed better. Let’s use all 11 features with 3 fully-connected relu layers and a final linear layer. The next cell takes a while to run. Skip to the results in the cell after if you like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Define</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeatures</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeatures</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeatures</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeatures</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train the model!</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeatures</span><span class="p">,</span> <span class="n">wineLabels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">validation_split</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="results">
<h3><span class="section-number">43.64.13.1. </span>Results<a class="headerlink" href="#results" title="Permalink to this headline">#</a></h3>
<p>If you train for long enough, the minimum achievable MSE is around 0.52, which is a decrease of 0.04 from the previous best loss of 0.56. This decrease probably isn’t worth the performance and complexity cost of using all your features and a deeper network. However, that decision depends on the objectives you’re optimizing for.</p>
<p>If you train the model long enough, the validation loss actually starts increasing while training loss continues to decrease. This divergence in loss curves means your model is overfitting. The overfitting results from the closer fit that your very complex model can learn. Stick with the simpler model. You’ll be happier and live longer!</p>
<p>If you do want to optimize your loss, then play with the model to find the minimum achievable training loss before overfitting sets in. Try playing with the network parameters in the code cell above to achieve a loss of 0.51. But be warned—optimizing your loss could take a lot of trial and error..</p>
</section>
</section>
<section id="conclusion">
<h2><span class="section-number">43.64.14. </span>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">#</a></h2>
<p>This Colab demonstrated the following principles:</p>
<ul class="simple">
<li><p>The most important step in machine learning is understanding your data.</p></li>
<li><p>The largest gains come from the initial features and network.</p></li>
<li><p>Returns diminish as you add features and complexity.</p></li>
<li><p>Incremental development provides confidence in model quality and allows benchmarking against previous results.</p></li>
<li><p>Reproducing previous results is extremely important. Hence, always use version control.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "open-academy/machine-learning",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./assignments/machine-learning-productionization"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="debugging-in-classification.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">43.63. </span>Case Study: Debugging in Classification</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../ml-fundamentals/study-the-solvers.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">43.65. </span>Study the solvers</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Ocademy<br/>
  
      &copy; Copyright 2022-2022.<br/>
    <div class="extra_footer">
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a> Text content of this work is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>